<!DOCTYPE html>
<html lang="uk">

<?php
    require_once __DIR__ . '/../../../helpers/header/header.php';
?>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../../../css/doctor-search.css">
    <title>–ó–∞–ø–∏—Å –¥–æ –ª—ñ–∫–∞—Ä—è</title>
</head>
<body>

    <div class="container">
        <div class="sidebar">
            <h2>–§—ñ–ª—å—Ç—Ä–∏</h2>
            <a class="reset-filters">–°–∫–∏–Ω—É—Ç–∏ –≤—Å—ñ</a>
            
            <h3>–ú—ñ—Å—Ç–æ</h3>
            <div class="filter-section">
            
                <select id="citySelect" class="city-select">
                    <option value="all">–£—Å—ñ –º—ñ—Å—Ç–∞</option>
                    <option value="kyiv">–ö–∏—ó–≤</option>
                    <option value="kharkiv" selected>–•–∞—Ä–∫—ñ–≤</option>
                    <option value="odesa">–û–¥–µ—Å–∞</option>
                    <option value="lviv">–õ—å–≤—ñ–≤</option>
                    <option value="dnipro">–î–Ω—ñ–ø—Ä–æ</option>
                    <option value="vinnytsia">–í—ñ–Ω–Ω–∏—Ü—è</option>
                    <option value="zhytomyr">–ñ–∏—Ç–æ–º–∏—Ä</option>
                </select>
            </div>
            
            <div class="filter-option">
                <input type="checkbox" id="online">
                <label for="online">–û–Ω–ª–∞–π–Ω –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—è</label>
            </div>
            
            <h3>–¢–∏–ø –∫–ª—ñ–Ω—ñ–∫–∏</h3>
            <div class="filter-option">
                <input type="checkbox" id="state">
                <label for="state">–î–µ—Ä–∂–∞–≤–Ω—ñ</label>
            </div>
            <div class="filter-option">
                <input type="checkbox" id="private">
                <label for="private">–ü—Ä–∏–≤–∞—Ç–Ω—ñ</label>
            </div>
            
            <h3>–°—Ç–∞—Ç—å –ª—ñ–∫–∞—Ä—è</h3>
            <div class="filter-option">
                <input type="checkbox" id="male">
                <label for="male">–ß–æ–ª–æ–≤—ñ–∫</label>
            </div>
            <div class="filter-option">
                <input type="checkbox" id="female">
                <label for="female">–ñ—ñ–Ω–∫–∞</label>
            </div>
            
            <h3>–°—Ç–∞–∂ –ª—ñ–∫–∞—Ä—è</h3>
            <div class="filter-option">
                <input type="checkbox" id="exp1">
                <label for="exp1">–≤—ñ–¥ 0 –¥–æ 5 —Ä–æ–∫—ñ–≤</label>
            </div>
            <div class="filter-option">
                <input type="checkbox" id="exp2">
                <label for="exp2">–≤—ñ–¥ 6 –¥–æ 10 —Ä–æ–∫—ñ–≤</label>
            </div>
            <div class="filter-option">
                <input type="checkbox" id="exp3">
                <label for="exp3">–≤—ñ–¥ 11 –¥–æ 15 —Ä–æ–∫—ñ–≤</label>
            </div>
            <div class="filter-option">
                <input type="checkbox" id="exp4">
                <label for="exp4">–≤—ñ–¥ 16 —Ä–æ–∫—ñ–≤</label>
            </div>
            
            <h3>–û—Ü—ñ–Ω—é–≤–∞–Ω–Ω—è –ø–∞—Ü—ñ—î–Ω—Ç–∞–º–∏</h3>
            <div class="filter-option">
                <input type="checkbox" id="rating0">
                <label for="rating0">–ë–µ–∑ –æ—Ü—ñ–Ω—é–≤–∞–Ω—å</label>
            </div>
            <div class="filter-option">
                <input type="checkbox" id="rating1">
                <label for="rating1">–ù–æ—Ä–º–∞–ª—å–Ω–æ</label>
            </div>
            <div class="filter-option">
                <input type="checkbox" id="rating2">
                <label for="rating2">–î–æ–±—Ä–µ</label>
            </div>
            <div class="filter-option">
                <input type="checkbox" id="rating3">
                <label for="rating3">–î—É–∂–µ –¥–æ–±—Ä–µ</label>
            </div>
            
            <h3>–ö–≤–∞–ª—ñ—Ñ—ñ–∫–∞—Ü—ñ—è –ª—ñ–∫–∞—Ä—è</h3>
            <table class="qualification-table">
                <tr>
                    <td>–ù–µ –æ–±—Ä–∞–Ω–∞</td>
                    <td class="selected">‚úî</td>
                </tr>
            </table>
        </div>
        
        <div class="main-content">
            <div class="search-container">
                <div class="search-bar">
                    <input type="text" placeholder="–ü–æ—à—É–∫ –ª—ñ–∫–∞—Ä—è –∞–±–æ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–æ—Å—Ç—ñ">
                    <button type="submit">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M11 19C15.4183 19 19 15.4183 19 11C19 6.58172 15.4183 3 11 3C6.58172 3 3 6.58172 3 11C3 15.4183 6.58172 19 11 19Z" stroke="#666" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M21 21L16.65 16.65" stroke="#666" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </button>
                </div>
            </div>
            
            <h2>–ó–∞–ø–∏—Å–∞—Ç–∏—Å—è –¥–æ –ª—ñ–∫–∞—Ä—è –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—é ‚Ä¢ <?php echo($result->num_rows); ?> –ª—ñ–∫–∞—Ä—è</h2>
            
<div class="doctors-container">
    <?php while ($row = $result->fetch_assoc()): ?>
        <?php $row['docName'] = $row['last_name'] . $row['first_name']; ?>
        <div class="doctor-card">
            <div class="doctor-info-container">
                <div class="doctor-header">
                    <img src="<?= htmlspecialchars($row['photo_url']) ?>" alt="<?= htmlspecialchars($row['name']) ?>" class="doctor-photo">
                    <div class="doctor-info-main">
                        <div class="doctor-specialty"><?= htmlspecialchars($row['name']) ?></div>
                        <div class="doctor-name"><?= htmlspecialchars($row['docName']) ?></div>
                        <div class="doctor-details">
                            <div class="detail-group">
                                <span class="detail-label">–£–º–æ–≤–∏ –ø—Ä–∏–π–æ–º—É</span>
                                <span class="detail-value doctor-price">–í—ñ–¥ <?= (int)$row['price'] ?> –≥—Ä–Ω</span>
                            </div>
                            <div class="detail-group">
                                <span class="detail-label">–ö–ª—ñ–Ω—ñ–∫–∞</span>
                                <span class="detail-value clinic-type"><?= htmlspecialchars($row['clinic_type']) ?></span>
                                <span class="clinic-name"><?= htmlspecialchars($row['clinic_name']) ?></span>
                            </div>
                            <div class="detail-group">
                                <span class="detail-label">–ú—ñ—Å—Ç–æ</span>
                                <span class="detail-value city"><?= htmlspecialchars($row['city']) ?></span>
                            </div>
                        </div>
                        <div class="doctor-rating">
                            <span class="rating-value"><?= number_format($row['rating'], 1) ?></span>
                            <span class="rating-count">(<?= (int)$row['review_count'] ?> –≤—ñ–¥–≥—É–∫–∏)</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="date-time-container">
                <div class="date-time-selection">
                    <div class="date-selector">
                        <?php
                        $days = ['–°—å–æ–≥–æ–¥–Ω—ñ', '–ó–∞–≤—Ç—Ä–∞', '–ß—Ç', '–ü—Ç'];
                        $dayDates = [
                            date('d M'),
                            date('d M', strtotime('+1 day')),
                            date('d M', strtotime('+2 days')),
                            date('d M', strtotime('+3 days')),
                        ];
                        foreach ($days as $i => $dayName):
                        ?>
                            <div class="date-option<?= $i === 0 ? ' active' : '' ?>">
                                <div class="day-name"><?= $dayName ?></div>
                                <div class="day-date"><?= $dayDates[$i] ?></div>
                            </div>
                        <?php endforeach; ?>
                    </div>
                    <div class="time-slots-container">
                        <?php foreach (['08:00','08:30','09:00','09:30','10:00','10:30','11:00','11:30','12:00'] as $time): ?>
                            <div class="time-slot"><?= $time ?></div>
                        <?php endforeach; ?>
                    </div>
                </div>
            </div>
        </div>
    <?php endwhile; ?>
</div>

    <div id="appointmentModal" class="modal">
        <div class="modal-content">
            <div class="steps">
                <div class="step active" data-step="1">
                    <div class="step-number">1</div>
                    <div class="step-title">–î–∞–Ω—ñ –∑–∞–ø–∏—Å—É</div>
                </div>
                <div class="step" data-step="2">
                    <div class="step-number">2</div>
                    <div class="step-title">–û–ø–ª–∞—Ç–∞</div>
                </div>
                <div class="step" data-step="3">
                    <div class="step-number">3</div>
                    <div class="step-title">–ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è</div>
                </div>
            </div>
            
            <!-- Step 1: Appointment Details -->
            <div class="step-content active" data-step="1">
                <div class="modal-header">
                    <h3 class="modal-title">–ó–∞–ø–∏—Å –Ω–∞ –ø—Ä–∏–π–æ–º</h3>
                    <span class="close-btn">&times;</span>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="appointmentDate">–î–∞—Ç–∞ —Ç–∞ —á–∞—Å</label>
                        <input type="text" id="appointmentDate" readonly>
                    </div>
                    <div class="form-group">
                        <label for="appointmentDoctor">–õ—ñ–∫–∞—Ä</label>
                        <input type="text" id="appointmentDoctor" readonly>
                    </div>
                    <div class="form-group">
                        <label for="patientName">–í–∞—à–µ —ñ–º'—è</label>
                        <input type="text" id="patientName" placeholder="–í–≤–µ–¥—ñ—Ç—å –≤–∞—à–µ –ø–æ–≤–Ω–µ —ñ–º'—è">
                    </div>
                    <div class="form-group">
                        <label for="patientPhone">–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É</label>
                        <input type="tel" id="patientPhone" placeholder="–í–≤–µ–¥—ñ—Ç—å –≤–∞—à –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É">
                    </div>
                    <div class="form-group">
                        <label for="patientEmail">Email (–Ω–µ–æ–±–æ–≤'—è–∑–∫–æ–≤–æ)</label>
                        <input type="email" id="patientEmail" placeholder="–í–≤–µ–¥—ñ—Ç—å –≤–∞—à email">
                    </div>
                    <div class="form-group">
                        <label for="problemDescription">–û–ø–∏—à—ñ—Ç—å –≤–∞—à—É –ø—Ä–æ–±–ª–µ–º—É</label>
                        <textarea id="problemDescription" placeholder="–î–µ—Ç–∞–ª—å–Ω–æ –æ–ø–∏—à—ñ—Ç—å —Å–∏–º–ø—Ç–æ–º–∏ –∞–±–æ –ø—Ä–∏—á–∏–Ω—É –∑–≤–µ—Ä–Ω–µ–Ω–Ω—è"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary close-btn">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
                    <button class="btn btn-primary next-step" data-next="2">–î–∞–ª—ñ: –û–ø–ª–∞—Ç–∞</button>
                </div>
            </div>
            
            <!-- Step 2: Payment -->
            <div class="step-content" data-step="2">
                <div class="modal-header">
                    <h3 class="modal-title">–û–ø–ª–∞—Ç–∞ –ø—Ä–∏–π–æ–º—É</h3>
                    <span class="close-btn">&times;</span>
                </div>
                <div class="modal-body">
                    <div class="payment-section">
                        <div class="payment-title">–°–ø–æ—Å—ñ–± –æ–ø–ª–∞—Ç–∏</div>
                        <div class="payment-options">
                            <div class="payment-option selected" data-payment="card">
                                <img src="https://cdn-icons-png.flaticon.com/512/196/196566.png" alt="–ö–∞—Ä—Ç–∫–∞">
                                <div>–ö–∞—Ä—Ç–∫–æ—é</div>
                            </div>
                            <div class="payment-option" data-payment="googlepay">
                                <img src="https://cdn-icons-png.flaticon.com/512/825/825454.png" alt="Google Pay">
                                <div>Google Pay</div>
                            </div>
                            <div class="payment-option" data-payment="applepay">
                                <img src="https://cdn-icons-png.flaticon.com/512/825/825482.png" alt="Apple Pay">
                                <div>Apple Pay</div>
                            </div>
                        </div>
                        
                        <!-- Card Payment Form -->
                        <div class="card-form" id="cardForm">
                            <div class="card-input-group">
                                <label for="cardNumber">–ù–æ–º–µ—Ä –∫–∞—Ä—Ç–∫–∏</label>
                                <div style="position: relative;">
                                    <input type="text" id="cardNumber" class="card-input" placeholder="1234 5678 9012 3456" maxlength="19">
                                    <img src="https://cdn-icons-png.flaticon.com/512/196/196578.png" class="card-icon" id="cardTypeIcon">
                                </div>
                            </div>
                            
                            <div class="card-row">
                                <div class="card-col">
                                    <label for="cardExpiry">–¢–µ—Ä–º—ñ–Ω –¥—ñ—ó</label>
                                    <input type="text" id="cardExpiry" class="card-input" placeholder="–ú–ú/–†–†" maxlength="5">
                                </div>
                                <div class="card-col">
                                    <label for="cardCvc">CVC/CVV</label>
                                    <input type="text" id="cardCvc" class="card-input" placeholder="123" maxlength="3">
                                </div>
                            </div>
                            
                            <div class="card-input-group">
                                <label for="cardName">–Ü–º'—è –Ω–∞ –∫–∞—Ä—Ç—Ü—ñ</label>
                                <input type="text" id="cardName" class="card-input" placeholder="–Ø–∫ –≤–∫–∞–∑–∞–Ω–æ –Ω–∞ –∫–∞—Ä—Ç—Ü—ñ">
                            </div>
                        </div>
                        
                        <div class="total-amount">–î–æ —Å–ø–ª–∞—Ç–∏: <span id="appointmentPrice">300</span> –≥—Ä–Ω</div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary prev-step" data-prev="1">–ù–∞–∑–∞–¥</button>
                    <button class="btn btn-primary next-step" data-next="3">–î–∞–ª—ñ: –ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è</button>
                </div>
            </div>
            
            <!-- Step 3: Confirmation -->
            <div class="step-content" data-step="3">
                <div class="modal-header">
                    <h3 class="modal-title">–ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –∑–∞–ø–∏—Å—É</h3>
                    <span class="close-btn">&times;</span>
                </div>
                <div class="modal-body">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <svg width="60" height="60" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" fill="#2ecc71" stroke="#2ecc71" stroke-width="2"/>
                            <path d="M8 12L11 15L16 9" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <h3 style="color: #2ecc71; margin-top: 10px;">–ó–∞–ø–∏—Å –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–æ!</h3>
                    </div>
                    
                    <div style="background-color: #f9f9f9; padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span style="color: #666;">–õ—ñ–∫–∞—Ä:</span>
                            <span id="confirmDoctor"></span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span style="color: #666;">–î–∞—Ç–∞ —Ç–∞ —á–∞—Å:</span>
                            <span id="confirmDateTime"></span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span style="color: #666;">–°—É–º–∞ –æ–ø–ª–∞—Ç–∏:</span>
                            <span id="confirmAmount"></span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: #666;">–ö–æ–¥ –∑–∞–ø–∏—Å—É:</span>
                            <span style="font-weight: bold;">#A7B9C2</span>
                        </div>
                    </div>
                    
                    <p style="text-align: center; color: #666; font-size: 14px;">
                        –î–µ—Ç–∞–ª—ñ –∑–∞–ø–∏—Å—É –±—É–ª–æ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ –≤–∞—à—É –µ–ª–µ–∫—Ç—Ä–æ–Ω–Ω—É –∞–¥—Ä–µ—Å—É. 
                        –í–∏ —Ç–∞–∫–æ–∂ –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –π–æ–≥–æ —É —Å–≤–æ—î–º—É –æ—Å–æ–±–∏—Å—Ç–æ–º—É –∫–∞–±—ñ–Ω–µ—Ç—ñ.
                    </p>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary" id="finishAppointment">–ó–∞–≤–µ—Ä—à–∏—Ç–∏</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Chat Button -->
    <div class="chat-btn" id="chatBtn">
        <div class="chat-icon">üí¨</div>
    </div>

    <!-- Chat Modal -->
    <div class="chat-modal" id="chatModal">
        <div class="chat-header">
            <div class="chat-title">–ß–∞—Ç –∑ –ª—ñ–∫–∞—Ä–µ–º</div>
            <div class="chat-close" id="chatClose">√ó</div>
        </div>
        <div class="chat-body" id="chatBody">
            <div class="message received">–î–æ–±—Ä–∏–π –¥–µ–Ω—å! –ß–∏–º –º–æ–∂—É –¥–æ–ø–æ–º–æ–≥—Ç–∏?</div>
            <div class="message sent">–î–æ–±—Ä–∏–π –¥–µ–Ω—å! –£ –º–µ–Ω–µ –ø–∏—Ç–∞–Ω–Ω—è —â–æ–¥–æ –∑–∞–ø–∏—Å—É –Ω–∞ –ø—Ä–∏–π–æ–º</div>
        </div>
        <div class="chat-footer">
            <input type="text" class="chat-input" id="chatInput" placeholder="–ù–∞–ø–∏—à—ñ—Ç—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è...">
            <button class="send-btn" id="sendBtn">‚Üë</button>
        </div>
    </div>
</body>

<script>

<script>
document.addEventListener('DOMContentLoaded', function() {
            // Get all time slots
            const timeSlots = document.querySelectorAll('.time-slot:not(.booked)');
            
            // Add click event to each time slot
            timeSlots.forEach(slot => {
                slot.addEventListener('click', function() {
                    // Remove selected class from all slots
                    timeSlots.forEach(s => s.classList.remove('selected'));
                    
                    // Add selected class to clicked slot
                    this.classList.add('selected');
                    
                    // Get appointment details
                    const dateOption = this.closest('.date-time-selection').querySelector('.date-option.active');
                    const dayName = dateOption.querySelector('.day-name').textContent;
                    const dayDate = dateOption.querySelector('.day-date').textContent;
                    const time = this.textContent;
                    
                    const doctorCard = this.closest('.doctor-card');
                    const doctorName = doctorCard.querySelector('.doctor-name').textContent;
                    const doctorSpecialty = doctorCard.querySelector('.doctor-specialty').textContent;
                    const doctorPrice = doctorCard.querySelector('.doctor-price').textContent.match(/\d+/)[0];
                    
                    // Fill modal with data
                    document.getElementById('appointmentDate').value = `${dayName}, ${dayDate} –æ ${time}`;
                    document.getElementById('appointmentDoctor').value = `${doctorName} (${doctorSpecialty})`;
                    document.getElementById('appointmentPrice').textContent = doctorPrice;
                    document.getElementById('confirmDoctor').textContent = `${doctorName} (${doctorSpecialty})`;
                    document.getElementById('confirmDateTime').textContent = `${dayName}, ${dayDate} –æ ${time}`;
                    document.getElementById('confirmAmount').textContent = `${doctorPrice} –≥—Ä–Ω`;
                    
                    // Show modal and reset to step 1
                    document.getElementById('appointmentModal').style.display = 'block';
                    showStep(1);
                });
            });
            // Close modal when clicking on X or cancel button
            const closeButtons = document.querySelectorAll('.close-btn');
            closeButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    document.getElementById('appointmentModal').style.display = 'none';
                });
            });
            
            // Close modal when clicking outside
            window.addEventListener('click', function(event) {
                if (event.target === document.getElementById('appointmentModal')) {
                    document.getElementById('appointmentModal').style.display = 'none';
                }
            });
            
            // Finish appointment
            document.getElementById('finishAppointment').addEventListener('click', function() {
                document.getElementById('appointmentModal').style.display = 'none';
                // Reset selected time slot
                document.querySelector('.time-slot.selected')?.classList.remove('selected');
            });
            
            // Payment option selection
            const paymentOptions = document.querySelectorAll('.payment-option');
            paymentOptions.forEach(option => {
                option.addEventListener('click', function() {
                    paymentOptions.forEach(opt => opt.classList.remove('selected'));
                    this.classList.add('selected');
                    
                    // Show/hide card form based on selection
                    if (this.dataset.payment === 'card') {
                        document.getElementById('cardForm').style.display = 'block';
                    } else {
                        document.getElementById('cardForm').style.display = 'none';
                    }
                });
            });
            
            // Card number formatting
            document.getElementById('cardNumber').addEventListener('input', function(e) {
                let value = e.target.value.replace(/\s+/g, '');
                if (value.length > 0) {
                    value = value.match(new RegExp('.{1,4}', 'g')).join(' ');
                }
                e.target.value = value;
                
                // Detect card type and show icon
                const cardType = detectCardType(value.replace(/\s/g, ''));
                const cardTypeIcon = document.getElementById('cardTypeIcon');
                
                if (cardType === 'visa') {
                    cardTypeIcon.src = 'https://cdn-icons-png.flaticon.com/512/196/196578.png';
                } else if (cardType === 'mastercard') {
                    cardTypeIcon.src = 'https://cdn-icons-png.flaticon.com/512/196/196566.png';
                } else {
                    cardTypeIcon.src = 'https://cdn-icons-png.flaticon.com/512/196/196561.png';
                }
            });
            
            // Expiry date formatting
            document.getElementById('cardExpiry').addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                if (value.length > 2) {
                    value = value.substring(0, 2) + '/' + value.substring(2, 4);
                }
                e.target.value = value;
            });
            
            // Step navigation
            document.querySelectorAll('.next-step').forEach(btn => {
                btn.addEventListener('click', function() {
                    const nextStep = parseInt(this.dataset.next);
                    if (validateStep(nextStep - 1)) {
                        showStep(nextStep);
                    }
                });
            });
            
            document.querySelectorAll('.prev-step').forEach(btn => {
                btn.addEventListener('click', function() {
                    const prevStep = parseInt(this.dataset.prev);
                    showStep(prevStep);
                });
            });
            
            function showStep(stepNumber) {
                // Update steps UI
                document.querySelectorAll('.step').forEach(step => {
                    const stepNum = parseInt(step.dataset.step);
                    step.classList.remove('active', 'completed');
                    
                    if (stepNum < stepNumber) {
                        step.classList.add('completed');
                    } else if (stepNum === stepNumber) {
                        step.classList.add('active');
                    }
                });
                
                // Show/hide step content
                document.querySelectorAll('.step-content').forEach(content => {
                    content.classList.remove('active');
                    if (parseInt(content.dataset.step) === stepNumber) {
                        content.classList.add('active');
                    }
                });
            }
            
            function validateStep(stepNumber) {
                if (stepNumber === 1) {
                    // Validate step 1 (appointment details)
                    const name = document.getElementById('patientName').value.trim();
                    const phone = document.getElementById('patientPhone').value.trim();
                    
                    if (!name) {
                        alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å –≤–∞—à–µ —ñ–º\'—è');
                        return false;
                    }
                    
                    if (!phone) {
                        alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å –≤–∞—à –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É');
                        return false;
                    }
                    
                    return true;
                } else if (stepNumber === 2) {
                    // Validate step 2 (payment)
                    const selectedPayment = document.querySelector('.payment-option.selected');
                    
                    if (!selectedPayment) {
                        alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–∏–±–µ—Ä—ñ—Ç—å —Å–ø–æ—Å—ñ–± –æ–ø–ª–∞—Ç–∏');
                        return false;
                    }
                    
                    if (selectedPayment.dataset.payment === 'card') {
                        const cardNumber = document.getElementById('cardNumber').value.replace(/\s/g, '');
                        const cardExpiry = document.getElementById('cardExpiry').value;
                        const cardCvc = document.getElementById('cardCvc').value;
                        const cardName = document.getElementById('cardName').value.trim();
                        
                        if (cardNumber.length < 16) {
                            alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å –∫–æ—Ä–µ–∫—Ç–Ω–∏–π –Ω–æ–º–µ—Ä –∫–∞—Ä—Ç–∫–∏');
                            return false;
                        }
                        
                        if (!cardExpiry || cardExpiry.length < 5) {
                            alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å –∫–æ—Ä–µ–∫—Ç–Ω–∏–π —Ç–µ—Ä–º—ñ–Ω –¥—ñ—ó –∫–∞—Ä—Ç–∫–∏');
                            return false;
                        }
                        
                        if (cardCvc.length < 3) {
                            alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å –∫–æ—Ä–µ–∫—Ç–Ω–∏–π CVC/CVV –∫–æ–¥');
                            return false;
                        }
                        
                        if (!cardName) {
                            alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å —ñ–º\'—è –Ω–∞ –∫–∞—Ä—Ç—Ü—ñ');
                            return false;
                        }
                    }
                    
                    return true;
                }
                
                return true;
            }
            
            function detectCardType(cardNumber) {
                // Very basic card type detection
                if (/^4/.test(cardNumber)) {
                    return 'visa';
                } else if (/^5[1-5]/.test(cardNumber)) {
                    return 'mastercard';
                }
                return 'unknown';
            }
            
            // Chat functionality
            const chatBtn = document.getElementById('chatBtn');
            const chatModal = document.getElementById('chatModal');
            const chatClose = document.getElementById('chatClose');
            const chatBody = document.getElementById('chatBody');
            const chatInput = document.getElementById('chatInput');
            const sendBtn = document.getElementById('sendBtn');
            
            chatBtn.addEventListener('click', function() {
                chatModal.style.display = 'flex';
            });
            
            chatClose.addEventListener('click', function() {
                chatModal.style.display = 'none';
            });
            
            function sendMessage() {
                const messageText = chatInput.value.trim();
                if (messageText) {
                    const messageElement = document.createElement('div');
                    messageElement.className = 'message sent';
                    messageElement.textContent = messageText;
                    chatBody.appendChild(messageElement);
                    chatInput.value = '';
                    
                    // Scroll to bottom
                    chatBody.scrollTop = chatBody.scrollHeight;
                    
                    // Simulate reply after 1 second
                    setTimeout(() => {
                        const replyElement = document.createElement('div');
                        replyElement.className = 'message received';
                        replyElement.textContent = '–î—è–∫—É—é –∑–∞ –≤–∞—à–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è. –Ø –≤—ñ–¥–ø–æ–≤—ñ–º –≤–∞–º –Ω–∞–π–±–ª–∏–∂—á–∏–º —á–∞—Å–æ–º.';
                        chatBody.appendChild(replyElement);
                        chatBody.scrollTop = chatBody.scrollHeight;
                    }, 1000);
                }
            }
            
            // –î–æ–¥–∞—Ç–∏ —Ü–µ–π –∫–æ–¥ —É –≤–∞—à —ñ—Å–Ω—É—é—á–∏–π script
document.getElementById('citySelect').addEventListener('change', function() {
    const selectedCity = this.value;
    const doctorCards = document.querySelectorAll('.doctor-card');
    
    doctorCards.forEach(card => {
        const cityElement = card.querySelector('.city');
        if (selectedCity === 'all' || cityElement.textContent.toLowerCase().includes(selectedCity)) {
            card.style.display = 'flex';
        } else {
            card.style.display = 'none';
        }
    });
});
            sendBtn.addEventListener('click', sendMessage);
            
            chatInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });
        });

</script>

<?php
    require_once __DIR__ . '/../../../helpers/footer/footer-page.php';
?>

</html>
